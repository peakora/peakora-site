<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Peakora Assistant</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="assistant.css" />
</head>
<body>
  <div class="assistant-shell">
    <div class="assistant-card">
      <header class="assistant-header">
        <div class="brand">
          <span class="brand-mark">●</span>
          <span class="brand-name">PEAKORA</span>
        </div>
        <div class="brand-tagline">Gentle guidance. Real momentum.</div>
      </header>

      <div class="assistant-progress">
        <div class="progress-label" id="progress-label">Step 1 of 9</div>
        <div class="progress-bar">
          <div class="progress-fill" id="progress-fill"></div>
        </div>
      </div>

      <main id="step-container" class="assistant-body">
        <!-- Steps render here -->
      </main>

      <footer class="assistant-footer">
        <span>Peakora Assistant · This is not medical advice.</span>
      </footer>
    </div>
  </div>

  <script>
    // --- STATE & STEPS -------------------------------------------------------

    const steps = [
      "welcome",
      "explanation",
      "goal",
      "challenge",
      "time",
      "insight",
      "extended1",
      "extended2",
      "email",
      "processing",
      "recommendations",
      "pricing",
      "done",
      "returning",   // returning user mode
      "exit",        // for "Not now"
      "daily_intro",
      "daily_checkin",
      "daily_summary",
    ];

    const onboardingSteps = [
      "welcome",
      "explanation",
      "goal",
      "challenge",
      "time",
      "insight",
      "extended1",
      "extended2",
      "email",
      "processing",
      "recommendations",
      "pricing",
      "done",
    ];

    const state = {
      stepIndex: 0,
      answers: {},
      email: "",
      completed: false,
    };

    const STORAGE_KEY = "peakora_assistant_state_v1";

    // --- STORAGE -------------------------------------------------------------

    function saveState() {
      try {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
      } catch (e) {
        console.warn("Could not save state:", e);
      }
    }

    function loadState() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (!raw) return false;
        const parsed = JSON.parse(raw);
        if (typeof parsed !== "object" || parsed === null) return false;

        state.stepIndex = typeof parsed.stepIndex === "number" ? parsed.stepIndex : 0;
        state.answers = parsed.answers || {};
        state.email = parsed.email || "";
        state.completed = !!parsed.completed;
        return true;
      } catch (e) {
        console.warn("Could not load state:", e);
        return false;
      }
    }

    function clearState() {
      try {
        localStorage.removeItem(STORAGE_KEY);
      } catch (e) {
        console.warn("Could not clear state:", e);
      }
      state.stepIndex = 0;
      state.answers = {};
      state.email = "";
      state.completed = false;
    }

    // --- PROGRESS ------------------------------------------------------------

    function setProgress() {
      const label = document.getElementById("progress-label");
      const fill = document.getElementById("progress-fill");

      const currentStepKey = steps[state.stepIndex];

      // Only onboarding steps count toward "Step X of Y"
      const idx = onboardingSteps.indexOf(currentStepKey);
      const total = onboardingSteps.length;

      if (idx === -1) {
        label.textContent = "Peakora Assistant";
        fill.style.width = "0%";
        return;
      }

      const stepNumber = idx + 1;
      label.textContent = `Step ${stepNumber} of ${total}`;
      const percent = (stepNumber / total) * 100;
      fill.style.width = `${percent}%`;
    }

    // --- NAVIGATION ----------------------------------------------------------

    function goToStepKey(key) {
      const idx = steps.indexOf(key);
      if (idx === -1) {
        console.error("Unknown step key:", key);
        return;
      }
      state.stepIndex = idx;
      saveState();
      renderStep();
    }

    function goToNext() {
      // For onboarding, just move forward
      if (state.stepIndex < steps.length - 1) {
        state.stepIndex += 1;
        saveState();
        renderStep();
      }
    }

    function goToPrevious() {
      if (state.stepIndex > 0) {
        state.stepIndex -= 1;
        saveState();
        renderStep();
      }
    }

    // --- RENDERING -----------------------------------------------------------

    function renderStep() {
      const container = document.getElementById("step-container");
      const stepKey = steps[state.stepIndex];

      setProgress();

      switch (stepKey) {
        case "welcome":
          container.innerHTML = `
            <div class="step">
              <h1>Hi, I’m Peakora.</h1>
              <p>Let’s create a gentle, realistic plan that actually fits your life.</p>
              <div class="actions">
                <button class="btn primary" onclick="goToStepKey('explanation')">Start</button>
              </div>
            </div>
          `;
          break;

        case "explanation":
          container.innerHTML = `
            <div class="step">
              <h2>How this works</h2>
              <p>I’ll ask you a few focused questions about your energy, time, and current challenges.</p>
              <p>Then I’ll build a 7‑day plan that feels kind, not punishing.</p>
              <div class="actions">
                <button class="btn secondary" onclick="goToStepKey('welcome')">Back</button>
                <button class="btn primary" onclick="goToStepKey('goal')">Continue</button>
              </div>
            </div>
          `;
          break;

        case "goal":
          container.innerHTML = `
            <div class="step">
              <h2>What do you want to focus on first?</h2>
              <textarea
                class="input"
                id="goal-input"
                placeholder="For example: sleep, stress, focus, movement, or something else…"
              ></textarea>
              <div class="actions">
                <button class="btn secondary" onclick="goToStepKey('explanation')">Back</button>
                <button class="btn primary" onclick="handleGoal()">Continue</button>
              </div>
            </div>
          `;
          break;

        case "challenge":
          container.innerHTML = `
            <div class="step">
              <h2>What’s making this hard right now?</h2>
              <textarea
                class="input"
                id="challenge-input"
                placeholder="Be honest. Overwhelm, time, motivation, pain, burnout…"
              ></textarea>
              <div class="actions">
                <button class="btn secondary" onclick="goToStepKey('goal')">Back</button>
                <button class="btn primary" onclick="handleChallenge()">Continue</button>
              </div>
            </div>
          `;
          break;

        case "time":
          container.innerHTML = `
            <div class="step">
              <h2>How much time can you realistically give this?</h2>
              <div class="options">
                <button class="btn ghost" onclick="handleTime('5–10 minutes')">5–10 minutes</button>
                <button class="btn ghost" onclick="handleTime('15–20 minutes')">15–20 minutes</button>
                <button class="btn ghost" onclick="handleTime('30+ minutes')">30+ minutes</button>
              </div>
              <div class="actions">
                <button class="btn secondary" onclick="goToStepKey('challenge')">Back</button>
              </div>
            </div>
          `;
          break;

        case "insight":
          container.innerHTML = `
            <div class="step">
              <h2>Before we build your plan…</h2>
              <p>Is there anything else I should know about your energy, mood, or current season of life?</p>
              <textarea
                class="input"
                id="insight-input"
                placeholder="You can skip this if nothing comes to mind."
              ></textarea>
              <div class="actions">
                <button class="btn secondary" onclick="goToStepKey('time')">Back</button>
                <button class="btn primary" onclick="handleInsight()">Continue</button>
              </div>
            </div>
          `;
          break;

        case "extended1":
          container.innerHTML = `
            <div class="step">
              <h2>What does “success” look like for you in the next 7 days?</h2>
              <textarea
                class="input"
                id="extended1-input"
                placeholder="Small, specific wins. Not perfection."
              ></textarea>
              <div class="actions">
                <button class="btn secondary" onclick="goToStepKey('insight')">Back</button>
                <button class="btn primary" onclick="handleExtended1()">Continue</button>
              </div>
            </div>
          `;
          break;

        case "extended2":
          container.innerHTML = `
            <div class="step">
              <h2>What usually derails you when you try to change things?</h2>
              <textarea
                class="input"
                id="extended2-input"
                placeholder="Patterns, triggers, people, thoughts… whatever feels true."
              ></textarea>
              <div class="actions">
                <button class="btn secondary" onclick="goToStepKey('extended1')">Back</button>
                <button class="btn primary" onclick="handleExtended2()">Continue</button>
              </div>
            </div>
          `;
          break;

        case "email":
          container.innerHTML = `
            <div class="step">
              <h2>Where should I send your 7‑day plan?</h2>
              <input
                type="email"
                class="input"
                id="email-input"
                placeholder="you@example.com"
                value="${state.email || ""}"
              />
              <div class="actions">
                <button class="btn secondary" onclick="goToStepKey('extended2')">Back</button>
                <button class="btn primary" onclick="handleEmail()">Get my plan</button>
              </div>
            </div>
          `;
          break;

        case "processing":
          container.innerHTML = `
            <div class="step step-centered">
              <h2>Building your plan…</h2>
              <p>I’m weaving your answers into something kind, realistic, and doable.</p>
              <div class="loader"></div>
            </div>
          `;
          // Simulate processing then move to recommendations
          setTimeout(() => {
            goToStepKey("recommendations");
          }, 1200);
          break;

        case "recommendations":
          container.innerHTML = `
            <div class="step">
              <h2>Your 7‑day plan is ready</h2>
              <p>I’ve sent it to <strong>${state.email || "your email"}</strong>.</p>
              <p>Here’s a quick preview of the kind of structure you’ll see:</p>
              <ul class="preview-list">
                <li>Gentle daily focus aligned with your goal</li>
                <li>One anchor habit that doesn’t collapse when life gets loud</li>
                <li>Built‑in forgiveness for off days</li>
              </ul>
              <div class="actions">
                <button class="btn primary" onclick="goToStepKey('pricing')">Continue</button>
              </div>
            </div>
          `;
          break;

        case "pricing":
          container.innerHTML = `
            <div class="step">
              <h2>What’s coming next inside Peakora</h2>
              <p>Right now, this assistant is free. Soon, you’ll be able to:</p>
              <ul class="preview-list">
                <li>Save multiple plans and revisit them anytime</li>
                <li>Track gentle daily check‑ins and see your patterns</li>
                <li>Get small, personalized nudges when you start to drift</li>
              </ul>
              <p>You’ll also be able to add Peakora to your home screen and use it like a light app.</p>
              <div class="actions">
                <button class="btn primary" onclick="goToStepKey('done')">Finish</button>
              </div>
            </div>
          `;
          break;

        case "done":
          state.completed = true;
          saveState();
          container.innerHTML = `
            <div class="step step-centered">
              <h2>You’re all set for now.</h2>
              <p>Your plan is on its way. You did something good for yourself today.</p>
              <p class="soft-note">You can come back anytime to explore new plans or gentle daily check‑ins.</p>
            </div>
          `;
          break;

        case "returning":
          renderReturningStep(container);
          break;

        case "exit":
          container.innerHTML = `
            <div class="step step-centered">
              <h2>All good for now.</h2>
              <p>You can come back to Peakora whenever you’re ready to explore your next gentle step.</p>
              <div class="actions">
                <button class="btn primary" onclick="handleBackToHome()">Back to home</button>
              </div>
            </div>
          `;
          break;

        case "daily_intro":
          container.innerHTML = `
            <div class="step">
              <h2>Daily check‑in</h2>
              <p>Let’s take a quick snapshot of how you’re doing today.</p>
              <div class="actions">
                <button class="btn secondary" onclick="goToStepKey('returning')">Back</button>
                <button class="btn primary" onclick="goToStepKey('daily_checkin')">Start check‑in</button>
              </div>
            </div>
          `;
          break;

        case "daily_checkin":
          container.innerHTML = `
            <div class="step">
              <h2>How are you feeling today?</h2>
              <textarea
                class="input"
                id="daily-input"
                placeholder="You can be as brief or detailed as you like."
              ></textarea>
              <div class="actions">
                <button class="btn secondary" onclick="goToStepKey('daily_intro')">Back</button>
                <button class="btn primary" onclick="handleDailyCheckin()">Continue</button>
              </div>
            </div>
          `;
          break;

        case "daily_summary":
          container.innerHTML = `
            <div class="step step-centered">
              <h2>Check‑in saved.</h2>
              <p>Thank you for pausing with yourself today.</p>
              <p class="soft-note">Soon, you’ll see patterns and gentle insights based on these moments.</p>
              <div class="actions">
                <button class="btn primary" onclick="goToStepKey('returning')">Back to menu</button>
              </div>
            </div>
          `;
          break;

        default:
          container.innerHTML = `
            <div class="step step-centered">
              <h2>Something went off track.</h2>
              <p>Let’s reset and start fresh.</p>
              <div class="actions">
                <button class="btn primary" onclick="resetAssistant()">Start over</button>
              </div>
            </div>
          `;
          break;
      }
    }

    // --- RETURNING USER SCREEN ----------------------------------------------

    function renderReturningStep(container) {
      const name = state.answers.name || "";
      const displayName = name ? `, ${name}` : "";

      const midOnboarding = !state.completed;

      container.innerHTML = `
        <div class="step">
          <h2>Welcome back${displayName}.</h2>
          <p>What would you like to do today?</p>
          <div class="options vertical">
            ${
              midOnboarding
                ? `<button class="btn ghost" onclick="handleReturningChoice('continue')">
                     Continue where I left off
                   </button>`
                : `<button class="btn ghost disabled">
                     You’ve completed your last plan
                   </button>`
            }
            <button class="btn ghost" onclick="handleReturningChoice('new')">
              Start a new plan
            </button>
            <button class="btn ghost" onclick="handleReturningChoice('daily')">
              Daily check‑in
            </button>
          </div>
        </div>
      `;
    }

    function handleReturningChoice(choice) {
      if (choice === "continue") {
        // Resume from saved stepIndex if still in onboarding
        if (!state.completed && onboardingSteps.includes(steps[state.stepIndex])) {
          renderStep();
        } else {
          // If something is off, restart onboarding
          state.stepIndex = steps.indexOf("welcome");
          state.completed = false;
          saveState();
          renderStep();
        }
      }

      if (choice === "new") {
        clearState();
        state.stepIndex = steps.indexOf("welcome");
        saveState();
        renderStep();
      }

      if (choice === "daily") {
        state.stepIndex = steps.indexOf("daily_intro");
        saveState();
        renderStep();
      }
    }

    // --- HANDLERS ------------------------------------------------------------

    function handleGoal() {
      const el = document.getElementById("goal-input");
      state.answers.goal = el.value.trim();
      saveState();
      goToStepKey("challenge");
    }

    function handleChallenge() {
      const el = document.getElementById("challenge-input");
      state.answers.challenge = el.value.trim();
      saveState();
      goToStepKey("time");
    }

    function handleTime(value) {
      state.answers.time = value;
      saveState();
      goToStepKey("insight");
    }

    function handleInsight() {
      const el = document.getElementById("insight-input");
      state.answers.insight = el.value.trim();
      saveState();
      goToStepKey("extended1");
    }

    function handleExtended1() {
      const el = document.getElementById("extended1-input");
      state.answers.extended1 = el.value.trim();
      saveState();
      goToStepKey("extended2");
    }

    function handleExtended2() {
      const el = document.getElementById("extended2-input");
      state.answers.extended2 = el.value.trim();
      saveState();
      goToStepKey("email");
    }

    function handleEmail() {
      const el = document.getElementById("email-input");
      const value = el.value.trim();
      if (!value || !value.includes("@")) {
        el.classList.add("input-error");
        return;
      }
      el.classList.remove("input-error");
      state.email = value;
      saveState();
      goToStepKey("processing");
    }

    function handleDailyCheckin() {
      const el = document.getElementById("daily-input");
      const value = el.value.trim();
      state.answers.lastDaily = value;
      saveState();
      goToStepKey("daily_summary");
    }

    function handleBackToHome() {
      // This is just a hook. On the live site, this can redirect to your homepage.
      window.location.href = "/";
    }

    function resetAssistant() {
      clearState();
      state.stepIndex = steps.indexOf("welcome");
      saveState();
      renderStep();
    }

    // --- INIT ----------------------------------------------------------------

    document.addEventListener("DOMContentLoaded", () => {
      const hasState = loadState();

      if (!hasState) {
        state.stepIndex = steps.indexOf("welcome");
        renderStep();
        return;
      }

      // If user has completed onboarding before → show returning screen
      if (state.completed === true) {
        state.stepIndex = steps.indexOf("returning");
        renderStep();
        return;
      }

      // If user is mid-onboarding → also show returning screen with "continue"
      if (state.completed === false) {
        state.stepIndex = steps.indexOf("returning");
        renderStep();
        return;
      }
    });
  </script>
</body>
</html>
