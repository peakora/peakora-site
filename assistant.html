<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Peakora Assistant</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Neutral premium Peakora dot favicon -->
  <link rel="icon" href="data:image/svg+xml,
    <svg xmlns='http://www.w3.org/2000/svg' width='64' height='64'>
      <circle cx='32' cy='32' r='28' fill='%23f5b35c'/>
    </svg>">

  <link rel="stylesheet" href="assistant.css" />
</head>

<body>
  <div class="assistant-shell">
    <div class="assistant-card fade">
      <header class="assistant-header">
        <div class="brand">
          <span class="brand-mark"></span>
          <span class="brand-name">PEAKORA</span>
        </div>
        <div class="brand-tagline">Gentle guidance. Real momentum.</div>
      </header>

      <div class="assistant-progress">
        <div class="progress-label" id="progress-label">Step 1 of 9</div>
        <div class="progress-bar">
          <div class="progress-fill" id="progress-fill"></div>
        </div>
      </div>

      <main id="step-container" class="assistant-body fade">
      </main>

      <footer class="assistant-footer">
        <span>Peakora Assistant · This is not medical advice.</span>
      </footer>
    </div>
  </div>

  <script>
    const steps = [
      "welcome",
      "explanation",
      "goal",
      "challenge",
      "time",
      "insight",
      "extended1",
      "extended2",
      "email",
      "processing",
      "recommendations",
      "pricing",
      "done",
      "returning",
      "exit",
      "daily_intro",
      "daily_checkin",
      "daily_summary",
    ];

    const onboardingSteps = [
      "welcome",
      "explanation",
      "goal",
      "challenge",
      "time",
      "insight",
      "extended1",
      "extended2",
      "email",
      "processing",
      "recommendations",
      "pricing",
      "done",
    ];

    const state = {
      stepIndex: 0,
      answers: {},
      email: "",
      completed: false,
    };

    const STORAGE_KEY = "peakora_assistant_state_v1";

    function saveState() {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
    }

    function loadState() {
      const raw = localStorage.getItem(STORAGE_KEY);
      if (!raw) return false;
      try {
        const parsed = JSON.parse(raw);
        state.stepIndex = parsed.stepIndex || 0;
        state.answers = parsed.answers || {};
        state.email = parsed.email || "";
        state.completed = !!parsed.completed;
        return true;
      } catch {
        return false;
      }
    }

    function clearState() {
      localStorage.removeItem(STORAGE_KEY);
      state.stepIndex = 0;
      state.answers = {};
      state.email = "";
      state.completed = false;
    }

    function setProgress() {
      const label = document.getElementById("progress-label");
      const fill = document.getElementById("progress-fill");
      const key = steps[state.stepIndex];
      const idx = onboardingSteps.indexOf(key);

      if (idx === -1) {
        label.textContent = "Peakora Assistant";
        fill.style.width = "0%";
        return;
      }

      const stepNum = idx + 1;
      const total = onboardingSteps.length;
      label.textContent = `Step ${stepNum} of ${total}`;
      fill.style.width = `${(stepNum / total) * 100}%`;
    }

    function goToStepKey(key) {
      const idx = steps.indexOf(key);
      if (idx === -1) return;
      state.stepIndex = idx;
      saveState();
      renderStep();
    }

    function goToNext() {
      state.stepIndex += 1;
      saveState();
      renderStep();
    }

    function goToPrevious() {
      if (state.stepIndex === 0) return;
      state.stepIndex -= 1;
      saveState();
      renderStep();
    }

    function fadeIn() {
      const card = document.querySelector(".assistant-card");
      const body = document.querySelector(".assistant-body");
      card.classList.remove("fade");
      body.classList.remove("fade");
      void card.offsetWidth;
      card.classList.add("fade");
      body.classList.add("fade");
    }

    function renderStep() {
      fadeIn();
      const container = document.getElementById("step-container");
      const key = steps[state.stepIndex];
      setProgress();

      if (key === "welcome") {
        container.innerHTML = `
          <div class="step">
            <h1>Hi, I’m Peakora.</h1>
            <p>Let’s take a gentle step toward the version of you that feels more grounded and steady.</p>
            <div class="actions">
              <button class="btn primary" onclick="goToStepKey('explanation')">Begin</button>
            </div>
          </div>`;
        return;
      }

      if (key === "explanation") {
        container.innerHTML = `
          <div class="step">
            <h2>How this works</h2>
            <p>I’ll ask a few simple questions about your energy, your time, and what’s weighing on you.</p>
            <p>Then I’ll shape a 7‑day plan that feels doable, not overwhelming.</p>
            <div class="actions">
              <button class="btn secondary" onclick="goToPrevious()">Back</button>
              <button class="btn primary" onclick="goToStepKey('goal')">Continue</button>
            </div>
          </div>`;
        return;
      }

      if (key === "goal") {
        container.innerHTML = `
          <div class="step">
            <h2>What do you want to focus on right now?</h2>
            <textarea class="input" id="goal-input" placeholder="Sleep, stress, focus, movement… whatever feels true."></textarea>
            <div class="actions">
              <button class="btn secondary" onclick="goToPrevious()">Back</button>
              <button class="btn primary" onclick="handleGoal()">Continue</button>
            </div>
          </div>`;
        return;
      }

      if (key === "challenge") {
        container.innerHTML = `
          <div class="step">
            <h2>What’s been getting in the way?</h2>
            <textarea class="input" id="challenge-input" placeholder="Be honest. Overwhelm, time, burnout, pain…"></textarea>
            <div class="actions">
              <button class="btn secondary" onclick="goToPrevious()">Back</button>
              <button class="btn primary" onclick="handleChallenge()">Continue</button>
            </div>
          </div>`;
        return;
      }

      if (key === "time") {
        container.innerHTML = `
          <div class="step">
            <h2>How much time can you realistically give this?</h2>
            <div class="options">
              <button class="btn ghost" onclick="handleTime('5–10 minutes')">5–10 minutes</button>
              <button class="btn ghost" onclick="handleTime('15–20 minutes')">15–20 minutes</button>
              <button class="btn ghost" onclick="handleTime('30+ minutes')">30+ minutes</button>
            </div>
            <div class="actions">
              <button class="btn secondary" onclick="goToPrevious()">Back</button>
            </div>
          </div>`;
        return;
      }

      if (key === "insight") {
        container.innerHTML = `
          <div class="step">
            <h2>Anything else I should understand about your current season?</h2>
            <textarea class="input" id="insight-input" placeholder="You can skip this if nothing comes to mind."></textarea>
            <div class="actions">
              <button class="btn secondary" onclick="goToPrevious()">Back</button>
              <button class="btn primary" onclick="handleInsight()">Continue</button>
            </div>
          </div>`;
        return;
      }

      if (key === "extended1") {
        container.innerHTML = `
          <div class="step">
            <h2>What would a small win look like this week?</h2>
            <textarea class="input" id="extended1-input" placeholder="Something gentle and specific."></textarea>
            <div class="actions">
              <button class="btn secondary" onclick="goToPrevious()">Back</button>
              <button class="btn primary" onclick="handleExtended1()">Continue</button>
            </div>
          </div>`;
        return;
      }

      if (key === "extended2") {
        container.innerHTML = `
          <div class="step">
            <h2>What usually derails you?</h2>
            <textarea class="input" id="extended2-input" placeholder="Patterns, triggers, thoughts…"></textarea>
            <div class="actions">
              <button class="btn secondary" onclick="goToPrevious()">Back</button>
              <button class="btn primary" onclick="handleExtended2()">Continue</button>
            </div>
          </div>`;
        return;
      }

      if (key === "email") {
        container.innerHTML = `
          <div class="step">
            <h2>Where should I send your plan?</h2>
            <input type="email" class="input" id="email-input" placeholder="you@example.com" value="${state.email}">
            <div class="actions">
              <button class="btn secondary" onclick="goToPrevious()">Back</button>
              <button class="btn primary" onclick="handleEmail()">Send my plan</button>
            </div>
          </div>`;
        return;
      }

      if (key === "processing") {
        container.innerHTML = `
          <div class="step step-centered">
            <h2>One moment</h2>
            <p>I’m shaping your plan with everything you shared.</p>
            <div class="loader"></div>
          </div>`;
        setTimeout(() => goToStepKey("recommendations"), 1200);
        return;
      }

      if (key === "recommendations") {
        container.innerHTML = `
          <div class="step">
            <h2>Your plan is ready</h2>
            <p>I’ve sent it to <strong>${state.email}</strong>.</p>
            <p>Here’s a small preview of what you’ll find inside:</p>
            <ul class="preview-list">
              <li>Daily focus that matches your energy</li>
              <li>One anchor habit to keep you steady</li>
              <li>Built‑in forgiveness for off days</li>
            </ul>
            <div class="actions">
              <button class="btn primary" onclick="goToStepKey('pricing')">Continue</button>
            </div>
          </div>`;
        return;
      }

      if (key === "pricing") {
        container.innerHTML = `
          <div class="step">
            <h2>What’s coming next</h2>
            <p>Right now, Peakora is free. Soon, you’ll be able to:</p>
            <ul class="preview-list">
              <li>Save multiple plans</li>
              <li>Track gentle daily check‑ins</li>
              <li>See patterns and insights over time</li>
            </ul>
            <p>You’ll also be able to add Peakora to your home screen for quick access.</p>
            <div class="actions">
              <button class="btn primary" onclick="goToStepKey('done')">Finish</button>
            </div>
          </div>`;
        return;
      }

      if (key === "done") {
        state.completed = true;
        saveState();
        container.innerHTML = `
          <div class="step step-centered">
            <h2>Your plan is on its way</h2>
            <p>You showed up for yourself today. That matters more than you think.</p>
            <p class="soft-note">Come back anytime for a new plan or a gentle check‑in.</p>
          </div>`;
        return;
      }

      if (key === "returning") {
        const name = state.answers.name || "";
        container.innerHTML = `
          <div class="step">
            <h2>Welcome back${name ? ", " + name : ""}</h2>
            <p>What would you like to do today?</p>
            <div class="options vertical">
              ${
                !state.completed
                  ? `<button class="btn ghost" onclick="handleReturningChoice('continue')">Continue where I left off</button>`
                  : `<button class="btn ghost disabled">You’ve completed your last plan</button>`
              }
              <button class="btn ghost" onclick="handleReturningChoice('new')">Start a new plan</button>
              <button class="btn ghost" onclick="handleReturningChoice('daily')">Daily check‑in</button>
            </div>
          </div>`;
        return;
      }

      if (key === "exit") {
        container.innerHTML = `
          <div class="step step-centered">
            <h2>All good</h2>
            <p>Whenever you’re ready, I’ll be here.</p>
            <div class="actions">
              <button class="btn primary" onclick="handleBackToHome()">Back to home</button>
            </div>
          </div>`;
        return;
      }

      if (key === "daily_intro") {
        container.innerHTML = `
          <div class="step">
            <h2>Daily check‑in</h2>
            <p>Let’s take a quick snapshot of how you’re doing today.</p>
            <div class="actions">
              <button class="btn secondary" onclick="goToStepKey('returning')">Back</button>
              <button class="btn primary" onclick="goToStepKey('daily_checkin')">Start</button>
            </div>
          </div>`;
        return;
      }

      if (key === "daily_checkin") {
        container.innerHTML = `
          <div class="step">
            <h2>How are you feeling today?</h2>
            <textarea class="input" id="daily-input" placeholder="You can be brief or detailed."></textarea>
            <div class="actions">
              <button class="btn secondary" onclick="goToPrevious()">Back</button>
              <button class="btn primary" onclick="handleDailyCheckin()">Continue</button>
            </div>
          </div>`;
        return;
      }

      if (key === "daily_summary") {
        container.innerHTML = `
          <div class="step step-centered">
            <h2>Check‑in saved</h2>
            <p>Thank you for pausing with yourself today.</p>
            <p class="soft-note">Soon, you’ll see patterns and gentle insights based on these moments.</p>
            <div class="actions">
              <button class="btn primary" onclick="goToStepKey('returning')">Back to menu</button>
            </div>
          </div>`;
        return;
      }
    }

    function handleGoal() {
      state.answers.goal = document.getElementById("goal-input").value.trim();
      saveState();
      goToStepKey("challenge");
    }

    function handleChallenge() {
      state.answers.challenge = document.getElementById("challenge-input").value.trim();
      saveState();
      goToStepKey("time");
    }

    function handleTime(v) {
      state.answers.time = v;
      saveState();
      goToStepKey("insight");
    }

    function handleInsight() {
      state.answers.insight = document.getElementById("insight-input").value.trim();
      saveState();
      goToStepKey("extended1");
    }

    function handleExtended1() {
      state.answers.extended1 = document.getElementById("extended1-input").value.trim();
      saveState();
      goToStepKey("extended2");
    }

    function handleExtended2() {
      state.answers.extended2 = document.getElementById("extended2-input").value.trim();
      saveState();
      goToStepKey("email");
    }

    function handleEmail() {
      const el = document.getElementById("email-input");
      const v = el.value.trim();
      if (!v.includes("@")) {
        el.classList.add("input-error");
        return;
      }
      el.classList.remove("input-error");
      state.email = v;
      saveState();
      goToStepKey("processing");
    }

    function handleDailyCheckin() {
      state.answers.lastDaily = document.getElementById("daily-input").value.trim();
      saveState();
      goToStepKey("daily_summary");
    }

    function handleReturningChoice(c) {
      if (c === "continue") {
        renderStep();
        return;
      }
      if (c === "new") {
        clearState();
        saveState();
        goToStepKey("welcome");
        return;
      }
      if (c === "daily") {
        goToStepKey("daily_intro");
        return;
      }
    }

    function handleBackToHome() {
      window.location.href = "/";
    }

    document.addEventListener("DOMContentLoaded", () => {
      const hasState = loadState();
      if (!hasState) {
        goToStepKey("welcome");
        return;
      }
      if (state.completed) {
        goToStepKey("returning");
        return;
      }
      goToStepKey("returning");
    });
  </script>
</body>
</html>
